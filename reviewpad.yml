groups:
  - name: required-labels
    description: List of labels that should be used
    spec: '["current-release", "draft", "future-release"]'

rules:
  - name: has-no-labels
    kind: patch
    description: Checks if the pull request has no labels
    spec: $length($labels()) <= 0
  - name: has-valid-label
    kind: patch
    description: Checks if label is current-release, draft or future-release
    spec: '$any($labels(), ($l: String => $isElementOf($l,$group("required-labels"))))'
  - name: has-current-release
    kind: patch
    description: Checks if current-release label is in use
    spec: '$any($labels(), ($l: String => $contains($l, "current-release")))'

workflows:
  - name: summarize
    description: Summarize the pull request
    run:
      - if: ($eventType() == "synchronize" || $eventType() == "opened") && $state() == "open"
        then: $summarize()
  - name: check-for-missing-labels
    description: check if PR has no label
    run:
      if:
        - rule: has-no-labels
      then:
        - $fail("No label assigned to pull request")
  - name: check-for-valid-labels
    description: check for the presence of a label in required-labels set
    run:
      if:
        - rule: has-valid-label
      then:
        - $info("Required label is present")
      else:
        - $fail($sprintf("One of [%s] should be assigned as a label to a PR", [$group("required-labels")]))
  - name: check-for-release-label
    description: check for the presence of a release label if future-release is present
    run:
      - $info("A step")
